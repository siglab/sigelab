

<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <h1>
      Laboratorios
      </h1>
      <ol class="breadcrumb">
        <li>
          <a href="#">
            <i class="fa fa-dashboard"></i> Home</a>
        </li>
        <li class="active">Dashboard laboratorios</li>
      </ol>
    </section>

    <!-- Main content -->
    <section class="content">

      <!-- Componente central de busqueda -->
      <div class="row">
        <div class="col-md-12 col-lg-12">
          <div class="box box-danger">
            <div class="box-header">
              <i class="fa fa-audio-description"></i>

              <h3 class="box-title">COMUNICACION MASIVA</h3>

            </div>

            <div class="box-body">
                <div class="box-header">
                    <i class="fa fa-flask"></i>

                    <h3 class="box-title">FILTROS</h3>
                </div>

                <div class="box-body">
                    <div class="col-md-4">
                        <p>
                        <mat-checkbox [formControl]="formCheckBox.universidad" (change)="controlChecks('universidad')">Universidad</mat-checkbox>
                        </p>                               
                    </div>
                    <div class="col-md-4">
                        <p>
                        <mat-checkbox [formControl]="formCheckBox.sede" (change)="controlChecks('sede')">Sede</mat-checkbox>
                        </p>
                        <p>
                        <mat-form-field>
                        <mat-select placeholder="Todas las Sedes" [formControl]="formSelect.sede" multiple>
                            <mat-option *ngFor="let sede of listSelect.sede" [value]="sede.id" >{{sede.nombre}}</mat-option>
                        </mat-select>
                        </mat-form-field>
                        </p>                                
                    </div>
                    <div class="col-md-4">
                        <p>
                        <mat-checkbox [formControl]="formCheckBox.subsede" (change)="controlChecks('subsede')" >SubSede</mat-checkbox>
                        </p>
                        <p>
                        <mat-form-field>
                        <mat-select placeholder="Todas las Subsedes" [formControl]="formSelect.subsede" multiple>
                            <mat-option *ngFor="let sede of listSelect.subsede" [value]="sede.id">{{sede.nombre}}</mat-option>
                        </mat-select>
                        </mat-form-field>
                        </p>                                
                    </div>
                    <div class="col-md-4">
                        <p>
                        <mat-checkbox [formControl]="formCheckBox.facultad" (change)="controlChecks('facultad')" >Facultad</mat-checkbox>
                        </p>
                        <p>
                        <mat-form-field>
                        <mat-select placeholder="Todas las Facultades" [formControl]="formSelect.facultad" multiple>
                            <mat-option *ngFor="let fac of listSelect.facultad" [value]="fac.id">{{fac.nombre}}</mat-option>
                        </mat-select>
                        </mat-form-field>
                        </p>                                                    
                    </div>
                    <div class="col-md-4">
                        <p>
                        <mat-checkbox [formControl]="formCheckBox.departamento" (change)="controlChecks('departamento')">Departamento</mat-checkbox>
                        </p>
                        <p>
                        <mat-form-field>
                        <mat-select placeholder="Todos los Departamentos" [formControl]="formSelect.departamento"  multiple>
                            <mat-option *ngFor="let dep of listSelect.departamento" [value]="dep">{{dep.nombre}}</mat-option>
                        </mat-select>
                        </mat-form-field>
                        </p>                                                    
                    </div>
                    <div class="col-md-4">
                        <p>
                        <mat-checkbox [formControl]="formCheckBox.escuela" (change)="controlChecks('escuela')">Escuela</mat-checkbox>
                        </p>
                        <p>
                        <mat-form-field>
                        <mat-select placeholder="Todas las Escuelas" [formControl]="formSelect.escuela" multiple>
                            <mat-option *ngFor="let esc of listSelect.escuela" [value]="esc">{{esc.nombre}}</mat-option>
                        </mat-select>
                        </mat-form-field>
                        </p>                                                    
                    </div>
                    
                       
                        
                    <!-- <form id="form-work" class="" name="form-work" action="#">

                            <fieldset>
                                <div class="row">
                                    <div class="form-group">
                                        <div class="col-md-2">

                                        <label><input class="checkbox" type="checkbox" id="universidad" name="universidad" [(ngModel)]="checkBox.universidad" (change)="controlChecks('universidad')" >Universidad</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-2">
                                            <label><input class="checkbox" type="checkbox" name="sede" id="sede" [(ngModel)]="checkBox.sede" (change)="controlChecks('sede')" >Sede</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-3">
                                        <label class="control-label" for="variatiosede"><strong>Sede</strong></label>
                                        <select style="height: 100%; width: 100%;" name="variatiosede" id="variatiosede" [(ngModel)]="objsel.sede" (change)="aplicarFiltro($event.target.value, 'sede')" >
                                            <option value="inicial">Seleccione una sede</option>
                                            <option *ngFor="let item of sedes" value="{{item.id}}" >{{item.nombre}}</option>
                                        </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-2">
                                            <label><input class="checkbox" type="checkbox" id="facultad" name="facultad"  [(ngModel)]="checkBox.facultad" (change)="controlChecks('facultad')" >Facultad</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-3">
                                        <label class="control-label" for="variatiofacul"><strong>Facultad</strong></label>
                                        <select style="height: 100%; width: 100%;" name="variatiofacultad" id="variatiofacultad" [(ngModel)]="objsel.facultad" (change)="aplicarFiltro($event.target.value, 'facultad')">
                                            <option value="inicial">Seleccione una facultad</option>
                                            <option *ngFor="let item of facultads" value="{{item.id}}" >{{item.nombre}}</option>
                                        </select>
                                        </div>
                                    </div>

                                </div>

                                <div class="row">
                                    <div class="form-group">
                                        <div class="col-md-2">

                                        <label><input class="checkbox" type="checkbox" id="departamento" name="departamento" [(ngModel)]="checkBox.departamento" (change)="controlChecks('departamento')" >Departamento</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-5">
                                        <label class="control-label" for="variatiodepar"><strong>Departamento</strong></label>
                                        <select style="height: 100%; width: 100%;" name="variatiodepartamento" id="variatiodepartamento" [(ngModel)]="objsel.departamento" (change)="aplicarFiltro($event.target.value, 'departamento')">
                                            <option value="inicial">Seleccione un departamento</option>
                                            <option *ngFor="let item of departamentos" value="{{item.id}}" >{{item.nombre}}</option>
                                        </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-2">
                                            <label><input class="checkbox" type="checkbox" id="escuela" name="escuela" [(ngModel)]="checkBox.escuela" (change)="controlChecks('escuela')">Escuela</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-3">
                                        <label class="control-label" for="variatioescuela"><strong>Escuela</strong></label>
                                        <select style="height: 100%; width: 100%;" name="variatioescuela" id="variatioescuela" [(ngModel)]="objsel.escuela" (change)="aplicarFiltro($event.target.value, 'escuela')">
                                            <option value="inicial">Seleccione una escuela</option>
                                            <option *ngFor="let item of escuelas" value="{{item.id}}" >{{item.nombre}}</option>
                                        </select>
                                        </div>
                                    </div>

                                </div>

                            </fieldset>
                    </form> -->

                </div>

                <div class="row" style="margin-top:30px;">
                    <div class="col-md-12">
                        <ul class="nav nav-tabs" >
                                <li><a class="tablas" data-toggle="tab"  href="#home">
                                    CORREO</a></li>
                                <li><a class="tablas" data-toggle="tab" href="#menu1">
                                    NOTIFICACION</a></li>
                                    <li><a class="tablas" data-toggle="tab" href="#menu2">
                                    HISTORIAL</a></li>
                        </ul>
                        <div class="tab-content">
                            <div id="home" class="tab-pane fade in active">

                                <div class="box box-danger">
                                    <div class="box-header">
                                        <i class="fa fa-flask"></i>

                                        <h3 class="box-title">CORREO</h3>
                                    </div>
    
                                    <div class="box-body">
                                        <form id="form-work" class="" name="form-work" action="#">
                                            <fieldset>
                                                <div class="form-group">
                                                    <div class="col-md-12">
                                                        <label class="control-label" for="asunt"><strong>Asunto</strong></label>
                                                        <input class="form-control" name="asunt" [(ngModel)]="correo.asunto" id="" type="text">
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <div class="col-md-12">
                                                    <label class="control-label" for="mensaje"><strong>Mensaje</strong></label>
                                                    <textarea class="form-control" name="mensaje" [(ngModel)]="correo.mensaje" id="" rows="5"></textarea>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <div class="col-md-12">
                                                        <button type="button" style="float: right;" (click)="enviarCorreoNotificacion('correo')" class="btn2 btn-danger btn-lg danger">Enviar</button>
                                                    </div>
    
                                                </div>
    
                                            </fieldset>
                                        </form>

                                    </div>

                                </div>

                            </div>

                            <div id="menu1" class="tab-pane fade">

                                    <div class="box box-danger">
                                        <div class="box-header">
                                            <i class="fa fa-flask"></i>
    
                                            <h3 class="box-title">NUEVA NOTIFICACION</h3>
                                        </div>
        
                                        <div class="box-body">
                                            <form id="form-work" class="" name="form-work" action="#">
                                                <fieldset>
                                                    <div class="form-group">
                                                        <div class="col-md-12">
                                                        <label class="control-label" for="just"><strong>Notificacion (max {{caracteres}})</strong></label>
                                                        <textarea class="form-control" name="just" id="" maxlength="140" [(ngModel)]="notificacion" rows="5" (input)="cambiarNumeroCaracteres($event.target.value)"></textarea>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <div class="col-md-12">
                                                            <button type="button" style="float: right;" (click)="enviarCorreoNotificacion('notificacion')" class="btn2 btn-danger btn-lg danger">Enviar</button>
                                                        </div>
        
                                                    </div>
        
                                                </fieldset>
                                            </form>
    
                                        </div>

                                    </div>

                            </div>

                            <div id="menu2" class="tab-pane fade">
                                <div class="box-header">
                                    <i class="fa fa-flask"></i>

                                    <h3 class="box-title">HISTORIAL</h3>
                                </div>
                                <div class="box-body">
                                        <div class="box-body">
                                                <div *ngIf="dataSource.data.length == 0">
                                                    <h3>AUN NO SE HAN ENVIADO CORREOS O NOTIFICACIONES</h3>
                                                </div>
                          
                                                <div class="example-container mat-elevation-z8" *ngIf="dataSource.data.length != 0">
                                                  <div class="example-header">
                                                    <mat-form-field>
                                                      <input style="outline: none;" matInput (keyup)="applyFilter($event.target.value)" placeholder="Buscar Personal">
                                                    </mat-form-field>
                                                  </div>
                          
                                                  <mat-table #tableComunicacion #sort="matSort" [dataSource]="dataSource" matSort>
                          
                          
                                                    <ng-container matColumnDef="asunto">
                                                      <mat-header-cell *matHeaderCellDef mat-sort-header> Asunto </mat-header-cell>
                                                      <mat-cell *matCellDef="let element"> {{element.asunto}} </mat-cell>
                                                    </ng-container>
                                                    <ng-container matColumnDef="tipo">
                                                        <mat-header-cell *matHeaderCellDef mat-sort-header> Asunto </mat-header-cell>
                                                        <mat-cell *matCellDef="let element"> {{element.type}} </mat-cell>
                                                    </ng-container>
                                                    <ng-container matColumnDef="email">
                                                        <mat-header-cell *matHeaderCellDef mat-sort-header> Asunto </mat-header-cell>
                                                        <mat-cell *matCellDef="let element"> {{element.email}} </mat-cell>
                                                    </ng-container>
                                                    <ng-container matColumnDef="fecha">
                                                        <mat-header-cell *matHeaderCellDef mat-sort-header> Asunto </mat-header-cell>
                                                        <mat-cell *matCellDef="let element"> {{element.fecha}} </mat-cell>
                                                    </ng-container>
                          
                                                    <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
                                                    <mat-row *matRowDef="let row; columns: displayedColumns;" style="cursor: pointer;" (click)="cambiarDataHistorial(row)"
                                                      data-toggle="modal" data-target="#modal1"></mat-row>
                                                  </mat-table>
                          
                                                  <mat-paginator #paginator="matPaginator" [pageSize]="5" [pageSizeOptions]="[5, 10, 20]" [showFirstLastButtons]="true">
                                                  </mat-paginator>
                                                </div>
                                            </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
          </div>
        </div>
      </div>


    </section>



</div>


<!-- MODAL QUE PERMITE LA EDICION DE LOS DATOS DEL LABORATORIO -->
<div *ngIf="historialsel" class="modal fade" id="modal1" role="dialog">
        <div [ngClass]="{'modal-dialog':true, 'modal-md':true}">
      
          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-body">
                <div class="box box-danger">
                    <div class="box-header text-center">
                      <i class="fa fa-address-card-o"></i>
          
                      <h3 class="box-title">Informacion de {{historialsel.type}}</h3>
                    </div>
           
                    <div class="box-body">
                        
                        <form>
                            <fieldset>
                                <div class="form-group">
                                <div class="col-md-12">
                                    <label class="control-label" for="nombreprub">
                                    <strong>Asunto :</strong> {{historialsel.asunto}}</label>               
                                </div>
                                </div>
                                <div class="form-group">
                                <div class="col-md-12">
                                    <label class="control-label" for="estadoserv">
                                    <strong>Mensaje:</strong> {{historialsel.mensaje}}</label>
                                </div>
                                </div>
                                <div class="form-group">
                                <div class="col-md-12">
                                    <label class="control-label" for="estadoserv">
                                    <strong>Estado:</strong> {{historialsel.email}}</label>
                                </div>
                                </div>
                                <div class="form-group">
                                <div class="col-md-12">
                                    <h2><strong>Filtros usados</strong></h2>
                                </div>
                                </div>
                                <div *ngFor = "let item of historialsel.texto" class="form-group">
                                <div class="col-md-12">
                                    <label class="control-label" for="estadoserv">
                                    <strong>{{item.key}}: </strong>{{item.nombre}}</label>
                                </div>
                                </div>
                                <div class="form-group">
                                    <div class="col-md-10">
                                        <button type="button" style="float: right;" (click)="editarFiltros('reenviar')" class="btn2 btn-success btn-lg success" >Reenviar</button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="col-md-2">                                       
                                        <button type="button" style="float: right;" (click)="editarFiltros('editar')" class="btn2 btn-danger btn-lg danger">Editar</button>
                                    </div>
                                </div>
                            </fieldset>
                        </form>
                                          
                    </div>
                </div>
      
      
              
            </div>
          </div>
        </div>
      </div>
