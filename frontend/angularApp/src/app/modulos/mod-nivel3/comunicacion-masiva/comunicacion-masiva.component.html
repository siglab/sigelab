<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
        <h1>
            Laboratorios
        </h1>
        <ol class="breadcrumb">
            <li>
                <a href="#">
                    <i class="fa fa-dashboard"></i> Home</a>
            </li>
            <li class="active">Dashboard laboratorios</li>
        </ol>
    </section>

    <!-- Main content -->
    <section class="content">

        <!-- Componente central de busqueda -->
        <div class="row">
            <div class="col-md-12 col-lg-12">
                <div class="box box-danger">
                    <div class="box-header">
                        <i class="fa fa-audio-description"></i>

                        <h3 class="box-title">COMUNICACIÓN MASIVA</h3>

                    </div>

                    <div class="box-body">
                        <div class="box-header">
                            <i class="fa fa-flask"></i>

                            <h3 class="box-title">FILTROS</h3>
                        </div>

                        <div class="box-body">
                            <div class="col-md-4">
                                <p>
                                    <mat-checkbox [formControl]="formCheckBox.universidad" (change)="controlChecks('universidad')">Universidad</mat-checkbox>
                                </p>
                            </div>
                            <div class="col-md-4">
                                <p>
                                    <mat-checkbox [formControl]="formCheckBox.sede" (change)="controlChecks('sede')">Seccional</mat-checkbox>
                                </p>
                                <p>
                                    <mat-form-field>
                                        <mat-select placeholder="Todas las Seccionales" [formControl]="formSelect.sede" multiple>
                                            <mat-option *ngFor="let sede of listSelect.sede" [value]="sede.id">{{sede.nombre}}</mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </p>
                            </div>
                            <div class="col-md-4">
                                <p>
                                    <mat-checkbox [formControl]="formCheckBox.subsede" (change)="controlChecks('subsede')">Sede</mat-checkbox>
                                </p>
                                <p>
                                    <mat-form-field>
                                        <mat-select placeholder="Todas las Sedes" [formControl]="formSelect.subsede" multiple>
                                            <mat-option *ngFor="let sede of listSelect.subsede" [value]="sede.id">{{sede.nombre}}</mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </p>
                            </div>
                            <div class="col-md-4">
                                <p>
                                    <mat-checkbox [formControl]="formCheckBox.facultad" (change)="controlChecks('facultad')">Facultad</mat-checkbox>
                                </p>
                                <p>
                                    <mat-form-field>
                                        <mat-select placeholder="Todas las Facultades" [formControl]="formSelect.facultad" multiple>
                                            <mat-option *ngFor="let fac of listSelect.facultad" [value]="fac.id">{{fac.nombre}}</mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </p>
                            </div>
                            <div class="col-md-4">
                                <p>
                                    <mat-checkbox [formControl]="formCheckBox.departamento" (change)="controlChecks('departamento')">Departamento</mat-checkbox>
                                </p>
                                <p>
                                    <mat-form-field>
                                        <mat-select placeholder="Todos los Departamentos" [formControl]="formSelect.departamento" multiple>
                                            <mat-option *ngFor="let dep of listSelect.departamento" [value]="dep">{{dep.nombre}}</mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </p>
                            </div>
                            <div class="col-md-4">
                                <p>
                                    <mat-checkbox [formControl]="formCheckBox.escuela" (change)="controlChecks('escuela')">Escuela</mat-checkbox>
                                </p>
                                <p>
                                    <mat-form-field>
                                        <mat-select placeholder="Todas las Escuelas" [formControl]="formSelect.escuela" multiple>
                                            <mat-option *ngFor="let esc of listSelect.escuela" [value]="esc">{{esc.nombre}}</mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </p>
                            </div>

                        </div>

                        <div class="row" style="margin-top:30px;">
                            <div class="col-md-12">
                                <ul class="nav nav-tabs">
                                    <li>
                                        <a class="tablas" data-toggle="tab" href="#home">
                                            CORREO</a>
                                    </li>
                                    <li>
                                        <a class="tablas" data-toggle="tab" href="#menu1">
                                            NOTIFICACIÓN</a>
                                    </li>
                                    <li>
                                        <a class="tablas" data-toggle="tab" href="#menu2">
                                            HISTORIAL</a>
                                    </li>
                                </ul>
                                <div class="tab-content">
                                    <div id="home" class="tab-pane fade in active">

                                        <div class="box box-danger">
                                            <div class="box-header">
                                                <i class="fa fa-flask"></i>

                                                <h3 class="box-title">CORREO</h3>
                                            </div>

                                            <div class="box-body">
                                                <form id="form-work" class="" name="form-work" action="#">
                                                    <fieldset>
                                                        <div class="form-group">
                                                            <div class="col-md-12">
                                                                <label class="control-label" for="asunt">
                                                                    <strong>Asunto</strong>
                                                                </label>
                                                                <input class="form-control" name="asunt" [(ngModel)]="correo.asunto" id="" type="text">
                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <div class="col-md-12">
                                                                <label class="control-label" for="mensaje">
                                                                    <strong>Mensaje</strong>
                                                                </label>
                                                                <app-ngx-editor name="mensaje" [placeholder]="'Enter text here...'" [spellcheck]="true" [(ngModel)]="correo.mensaje"></app-ngx-editor>
                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <div class="col-md-12">
                                                                <button type="button" style="float: right;" (click)="enviarCorreoNotificacion('correo')" class="btn2 btn-danger btn-lg danger">Enviar</button>
                                                            </div>

                                                        </div>

                                                    </fieldset>
                                                </form>

                                            </div>

                                        </div>

                                    </div>

                                    <div id="menu1" class="tab-pane fade">

                                        <div class="box box-danger">
                                            <div class="box-header">
                                                <i class="fa fa-flask"></i>

                                                <h3 class="box-title">NUEVA NOTIFICACIÓN</h3>
                                            </div>

                                            <div class="box-body">
                                                <form id="form-work" class="" name="form-work" action="#">
                                                    <fieldset>
                                                        <div class="form-group">
                                                            <div class="col-md-12">
                                                                <label class="control-label" for="just">
                                                                    <strong>Notificación (máx {{caracteres}})</strong>
                                                                </label>
                                                                <textarea class="form-control" name="just" id="" maxlength="140" [(ngModel)]="notificacion" rows="5" (input)="cambiarNumeroCaracteres($event.target.value)"></textarea>
                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <div class="col-md-12">
                                                                <button type="button" style="float: right;" (click)="enviarCorreoNotificacion('notificacion')" class="btn2 btn-danger btn-lg danger">Enviar</button>
                                                            </div>

                                                        </div>

                                                    </fieldset>
                                                </form>

                                            </div>

                                        </div>

                                    </div>

                                    <div id="menu2" class="tab-pane fade">
                                        <div class="box-header">
                                            <i class="fa fa-flask"></i>

                                            <h3 class="box-title">HISTORIAL</h3>
                                        </div>
                                        <div class="box-body">
                                            <div class="box-body">
                                                <div *ngIf="dataSource.data.length == 0" class="no-data">
                                                    <h3>AÚN NO SE HAN ENVIADO CORREOS O NOTIFICACIONES</h3>
                                                </div>

                                                <div class="example-container mat-elevation-z8" *ngIf="dataSource.data.length != 0">
                                                    <div class="example-header">
                                                        <mat-form-field>
                                                            <input style="outline: none;" matInput (keyup)="applyFilter($event.target.value)" placeholder="Buscar Personal">
                                                        </mat-form-field>
                                                    </div>

                                                    <mat-table #tableComunicacion #sort="matSort" [dataSource]="dataSource" matSort>


                                                        <ng-container matColumnDef="asunto">
                                                            <mat-header-cell *matHeaderCellDef mat-sort-header> Asunto </mat-header-cell>
                                                            <mat-cell *matCellDef="let element"> {{element.asunto}} </mat-cell>
                                                        </ng-container>
                                                        <ng-container matColumnDef="tipo">
                                                            <mat-header-cell *matHeaderCellDef mat-sort-header> Tipo </mat-header-cell>
                                                            <mat-cell *matCellDef="let element"> {{element.type}} </mat-cell>
                                                        </ng-container>
                                                        <ng-container matColumnDef="email">
                                                            <mat-header-cell *matHeaderCellDef mat-sort-header> Email remitente </mat-header-cell>
                                                            <mat-cell *matCellDef="let element"> {{element.email}} </mat-cell>
                                                        </ng-container>
                                                        <ng-container matColumnDef="fecha">
                                                            <mat-header-cell *matHeaderCellDef mat-sort-header> Fecha </mat-header-cell>
                                                            <mat-cell *matCellDef="let element"> {{element.fecha.split('T')[0]}} </mat-cell>
                                                        </ng-container>

                                                        <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
                                                        <mat-row *matRowDef="let row; columns: displayedColumns;" style="cursor: pointer;" (click)="cambiarDataHistorial(row)" data-toggle="modal"
                                                            data-target="#modal1"></mat-row>
                                                    </mat-table>

                                                    <mat-paginator #paginator="matPaginator" [pageSize]="5" [pageSizeOptions]="[5, 10, 20]" [showFirstLastButtons]="true">
                                                    </mat-paginator>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>


    </section>



</div>


<!-- MODAL QUE PERMITE LA EDICION DE LOS DATOS DEL LABORATORIO -->
<div *ngIf="historialsel" class="modal fade" id="modal1" role="dialog">
    <div [ngClass]="{'modal-dialog':true, 'modal-md':true}">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-body">
                <div class="box box-danger">
                    <div class="box-header text-center">
                        <i class="fa fa-address-card-o"></i>

                        <h3 class="box-title">Información de {{historialsel.type}}</h3>
                    </div>

                    <div class="box-body">

                        <form>
                            <fieldset>
                                <div class="form-group">
                                    <div class="col-md-12">
                                        <label class="control-label" for="estadoserv">
                                            <strong>Fecha:</strong> {{historialsel.fecha.split('T')[0]}}</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="col-md-12">
                                        <label class="control-label" for="nombreprub">
                                            <strong>Asunto :</strong> {{historialsel.asunto}}</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                        <div class="col-md-12">
                                            <label class="control-label" for="estadoserv">
                                                <strong>Email remitente:</strong> {{historialsel.email}}</label>
                                        </div>
                                    </div>
                                <div class="form-group">
                                    <div class="col-md-12">
                                        <label class="control-label" for="estadoserv">
                                            <strong>Mensaje:</strong><br> 
                                            <div id="mensajeHtml"></div></label>
                                    </div>
                                </div>
                              
                                <div class="form-group">
                                    <div class="col-md-12 text-center">
                                        <h3>
                                            <strong>Filtros usados</strong>
                                        </h3>
                                    </div>
                                </div>
                                <div *ngFor="let item of historialsel.filtro" class="form-group">
                                    <div class="col-md-12">
                                        <label class="control-label" for="estadoserv">
                                            <strong>{{item}}: </strong>
                                            <div *ngIf="item != 'universidad'">
                                                <p *ngFor="let text of historialsel.texto[item]">{{text}}</p>
                                            </div>
                                            <div *ngIf="item == 'universidad'">
                                                <p >{{historialsel.texto[item]}}</p>
                                            </div>
                                            
                                        </label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="col-md-10">
                                        <button type="button" style="float: right;" (click)="editarFiltros('reenviar')" class="btn btn-success">Reenviar</button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="col-md-2">
                                        <button type="button" style="float: right;" (click)="editarFiltros('editar')" class="btn btn-danger">Editar</button>
                                    </div>
                                </div>
                            </fieldset>
                        </form>

                    </div>
                </div>



            </div>
        </div>
    </div>
</div>